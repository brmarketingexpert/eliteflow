'use strict';
function _0x4d3a() {
    const _0x34c629 = [
        'join',
        '1793736NEjxwD',
        'IbPbI',
        'assign',
        '\x20|\x20Ticket:',
        'age\x20is\x20(te',
        'tdybk',
        'date\x20ok',
        'image',
        'sendFile',
        'sendImage',
        'fs/promise',
        'then',
        'fault',
        'VYHJD',
        'NDnFE',
        'OMxFK',
        'GYHmL',
        'where',
        'Message\x20Up',
        '../../mode',
        'fewUp',
        'info',
        'BTNNt',
        'createdAt',
        'ers/SetTic',
        'fOQWP',
        'includes',
        'path',
        'defineProp',
        'logger',
        'file',
        '__esModule',
        'DURnI',
        'mediaUrl',
        'sYToC',
        'AEMwY',
        'LnuuC',
        'zWaaP',
        '342wwuBJW',
        'ZGBNv',
        'pending',
        'sAsRead',
        'KykhI',
        'mp4',
        'sharp',
        ')::\x20',
        'sendVideo',
        'split',
        'nant:\x20',
        'WkSMo',
        'messengerI',
        'next',
        'id:\x20',
        '20016RZCRxW',
        'readFile',
        'Error\x20send',
        'sended',
        '68uHyDlJ',
        'lpllD',
        'quotedMsg',
        'contact',
        'ers/socket',
        'fluent-ffm',
        'video',
        'GrIyP',
        'mTime',
        'YUSed',
        'default',
        'NwBhe',
        's/logger',
        'sendAudio',
        '4403135ySCUAs',
        '\x20message\x20(',
        'IcadJ',
        'ticket',
        'jpjro',
        'orfrv',
        'ketMessage',
        'domTime',
        'Emit',
        'chat',
        'sendText',
        '225381dBidxw',
        'text',
        'chat:ack',
        'ASC',
        '__awaiter',
        'lte',
        'messenger',
        'ls/Ticket',
        '10LbZmXC',
        'qpMbv',
        's/sleepRan',
        'messageId',
        'applicatio',
        'GuhOh',
        'timestamp',
        'peg',
        'ptt',
        '1783MXcHJE',
        'mediaType',
        'tenantId',
        'value',
        'XkGcK',
        '../../help',
        'filename',
        'findAll',
        'update',
        'hOQrW',
        'closed',
        'erty',
        'BPruK',
        'ls/Message',
        'Error\x20mess',
        '42WmHEWp',
        'throw',
        '4XnSxhH',
        'done',
        'sequelize',
        '.mp4',
        'mediaName',
        'sleepRando',
        'document',
        'toFormat',
        'audio',
        'protI',
        'body',
        'ygPNr',
        'jpeg',
        '__importDe',
        'utUcZ',
        'end',
        'public',
        'dataValues',
        'saveToFile',
        'toBuffer',
        '188447HiLTnI',
        '1858570tSNnIQ',
        'error',
        'icPQF',
        '../../util',
        'apply'
    ];
    _0x4d3a = function () {
        return _0x34c629;
    };
    return _0x4d3a();
}
function _0x3ec6(_0x24c7be, _0x5bfa0c) {
    const _0x59d8bc = _0x4d3a();
    return _0x3ec6 = function (_0x5a2931, _0x3fded6) {
        _0x5a2931 = _0x5a2931 - (0x4 * 0x1e9 + 0xcd7 + 0x1 * -0x13b2);
        let _0x207f5c = _0x59d8bc[_0x5a2931];
        return _0x207f5c;
    }, _0x3ec6(_0x24c7be, _0x5bfa0c);
}
const _0x4a536e = _0x3ec6;
(function (_0x779a85, _0x1f4716) {
    const _0x3156c3 = _0x3ec6, _0x19afee = _0x779a85();
    while (!![]) {
        try {
            const _0x526771 = -parseInt(_0x3156c3(0xff)) / (0x5e * 0x65 + 0x4 * 0x80e + -0x454d) * (parseInt(_0x3156c3(0xd5)) / (-0x240a + 0x1 * -0x253f + -0x1 * -0x494b)) + -parseInt(_0x3156c3(0xee)) / (0x4cc * -0x8 + 0x57 + 0x983 * 0x4) * (parseInt(_0x3156c3(0x110)) / (-0x140d * 0x1 + 0x6 * -0x63d + 0x397f * 0x1)) + parseInt(_0x3156c3(0x125)) / (-0xa7c + 0x81 * -0x2b + 0x202c) + parseInt(_0x3156c3(0x10e)) / (0x248c + 0x15c5 * 0x1 + -0x3a4b) * (-parseInt(_0x3156c3(0x124)) / (0x1a98 + 0x1168 * 0x1 + -0x2bf9)) + -parseInt(_0x3156c3(0xd1)) / (-0x1922 + 0x8e6 + -0x6 * -0x2b6) * (parseInt(_0x3156c3(0x151)) / (-0x11 * -0x119 + -0x4d1 + -0x7 * 0x1f9)) + -parseInt(_0x3156c3(0xf6)) / (0x25fc + -0x3 * 0x152 + -0x32 * 0xae) * (-parseInt(_0x3156c3(0xe3)) / (0x56e + 0x4b5 * -0x7 + -0x498 * -0x6)) + -parseInt(_0x3156c3(0x12b)) / (0x398 + -0x47f + -0x51 * -0x3);
            if (_0x526771 === _0x1f4716)
                break;
            else
                _0x19afee['push'](_0x19afee['shift']());
        } catch (_0x2eea13) {
            _0x19afee['push'](_0x19afee['shift']());
        }
    }
}(_0x4d3a, 0x3cce3 + 0x1 * -0x1c594 + 0x8951 * 0x2));
var __awaiter = this && this[_0x4a536e(0xf2)] || function (_0x5cce3f, _0x465d30, _0x50a2ed, _0xdcdffa) {
        const _0x494e4f = _0x4a536e, _0xc5e40e = {
                'protI': function (_0xf87851, _0x41e63e) {
                    return _0xf87851(_0x41e63e);
                },
                'OMxFK': function (_0x3b0d38, _0x12b8c2) {
                    return _0x3b0d38 instanceof _0x12b8c2;
                },
                'DURnI': _0x494e4f(0x10f),
                'YUSed': function (_0x211caa, _0x247d32) {
                    return _0x211caa(_0x247d32);
                }
            };
        function _0x36222d(_0x2fff00) {
            const _0x840381 = _0x494e4f;
            return _0xc5e40e[_0x840381(0x13a)](_0x2fff00, _0x50a2ed) ? _0x2fff00 : new _0x50a2ed(function (_0x4b0408) {
                const _0x54ff04 = _0x840381;
                _0xc5e40e[_0x54ff04(0x119)](_0x4b0408, _0x2fff00);
            });
        }
        return new (_0x50a2ed || (_0x50a2ed = Promise))(function (_0x5a7590, _0x36e201) {
            const _0x1386f8 = _0x494e4f, _0x1f4bad = {
                    'KykhI': function (_0x46b953, _0x4f759f) {
                        const _0x28fd64 = _0x3ec6;
                        return _0xc5e40e[_0x28fd64(0x119)](_0x46b953, _0x4f759f);
                    }
                };
            function _0xc2b315(_0x27582c) {
                const _0x11b788 = _0x3ec6;
                try {
                    _0x1f4bad[_0x11b788(0x155)](_0x4771c1, _0xdcdffa[_0x11b788(0xcf)](_0x27582c));
                } catch (_0x276d63) {
                    _0x1f4bad[_0x11b788(0x155)](_0x36e201, _0x276d63);
                }
            }
            function _0x206ef9(_0x5fbabd) {
                const _0x3a8e93 = _0x3ec6;
                try {
                    _0xc5e40e[_0x3a8e93(0x119)](_0x4771c1, _0xdcdffa[_0xc5e40e[_0x3a8e93(0x14b)]](_0x5fbabd));
                } catch (_0x234e13) {
                    _0xc5e40e[_0x3a8e93(0x119)](_0x36e201, _0x234e13);
                }
            }
            function _0x4771c1(_0x4d5c54) {
                const _0xb49b3d = _0x3ec6;
                _0x4d5c54[_0xb49b3d(0x111)] ? _0x1f4bad[_0xb49b3d(0x155)](_0x5a7590, _0x4d5c54[_0xb49b3d(0x102)]) : _0x1f4bad[_0xb49b3d(0x155)](_0x36222d, _0x4d5c54[_0xb49b3d(0x102)])[_0xb49b3d(0x136)](_0xc2b315, _0x206ef9);
            }
            _0xc5e40e[_0x1386f8(0xde)](_0x4771c1, (_0xdcdffa = _0xdcdffa[_0x1386f8(0x129)](_0x5cce3f, _0x465d30 || []))[_0x1386f8(0xcf)]());
        });
    }, __importDefault = this && this[_0x4a536e(0x11d) + _0x4a536e(0x137)] || function (_0x1c0585) {
        const _0x412ae0 = _0x4a536e;
        return _0x1c0585 && _0x1c0585[_0x412ae0(0x14a)] ? _0x1c0585 : { 'default': _0x1c0585 };
    };
const _0x40ccec = {};
_0x40ccec[_0x4a536e(0x102)] = !![], Object[_0x4a536e(0x147) + _0x4a536e(0x10a)](exports, _0x4a536e(0x14a), _0x40ccec);
const promises_1 = require(_0x4a536e(0x135) + 's'), fluent_ffmpeg_1 = __importDefault(require(_0x4a536e(0xda) + _0x4a536e(0xfd))), path_1 = require(_0x4a536e(0x146)), sequelize_1 = require(_0x4a536e(0x112)), sharp_1 = __importDefault(require(_0x4a536e(0x157))), SetTicketMessagesAsRead_1 = __importDefault(require(_0x4a536e(0x104) + _0x4a536e(0x143) + _0x4a536e(0xe9) + _0x4a536e(0x154))), socketEmit_1 = __importDefault(require(_0x4a536e(0x104) + _0x4a536e(0xd9) + _0x4a536e(0xeb))), Message_1 = __importDefault(require(_0x4a536e(0x13e) + _0x4a536e(0x10c))), Ticket_1 = __importDefault(require(_0x4a536e(0x13e) + _0x4a536e(0xf5))), logger_1 = require(_0x4a536e(0x128) + _0x4a536e(0xe1)), sleepRandomTime_1 = require(_0x4a536e(0x128) + _0x4a536e(0xf8) + _0x4a536e(0xea)), MessengerSendMessagesSystem = (_0x28e4e3, _0x2f6bec) => __awaiter(void (0x987 + -0x5 * -0x47f + 0x1 * -0x2002), void (-0x27 * 0x3 + -0x2553 + 0x25c8), void (-0x6 * -0x50f + -0xbd + -0x1d9d), function* () {
        const _0x11817a = _0x4a536e, _0x4cf910 = {
                'BTNNt': _0x11817a(0x156),
                'zWaaP': _0x11817a(0x126),
                'AEMwY': _0x11817a(0x11f),
                'LnuuC': _0x11817a(0x153),
                'BPruK': _0x11817a(0xd8),
                'fewUp': _0x11817a(0xe6),
                'qpMbv': _0x11817a(0x109),
                'NDnFE': _0x11817a(0xf4),
                'WkSMo': _0x11817a(0xd7),
                'sYToC': _0x11817a(0x142),
                'utUcZ': _0x11817a(0xf1),
                'orfrv': _0x11817a(0xec),
                'ZGBNv': _0x11817a(0xef),
                'GuhOh': _0x11817a(0x120),
                'GYHmL': function (_0x385dc6, _0x2d77b0) {
                    return _0x385dc6 === _0x2d77b0;
                },
                'XkGcK': _0x11817a(0x118),
                'icPQF': function (_0x5f26a6, _0x2b40ba) {
                    return _0x5f26a6 === _0x2b40ba;
                },
                'fOQWP': _0x11817a(0xfe),
                'tdybk': _0x11817a(0x132),
                'ygPNr': _0x11817a(0xdb),
                'hOQrW': _0x11817a(0xfa) + 'n',
                'lpllD': _0x11817a(0x149),
                'jpjro': _0x11817a(0x116),
                'GrIyP': _0x11817a(0xd4),
                'IcadJ': _0x11817a(0xf0),
                'VYHJD': _0x11817a(0x13d) + _0x11817a(0x131),
                'NwBhe': function (_0x3a50ae, _0x1d97c4) {
                    return _0x3a50ae(_0x1d97c4);
                },
                'IbPbI': function (_0x1ad2c5, _0xdf2319) {
                    return _0x1ad2c5(_0xdf2319);
                }
            }, _0x12a9a4 = { [sequelize_1['Op']['is']]: null }, _0x3ad838 = {
                'fromMe': !![],
                'messageId': _0x12a9a4,
                'status': _0x4cf910[_0x11817a(0x14f)],
                [sequelize_1['Op']['or']]: [
                    { 'scheduleDate': { [sequelize_1['Op'][_0x11817a(0xf3)]]: new Date() } },
                    { 'scheduleDate': { [sequelize_1['Op']['is']]: null } }
                ]
            }, _0x4c1916 = yield Message_1[_0x11817a(0xdf)][_0x11817a(0x106)]({
                'where': _0x3ad838,
                'include': [
                    _0x4cf910[_0x11817a(0x10b)],
                    {
                        'model': Ticket_1[_0x11817a(0xdf)],
                        'as': _0x4cf910[_0x11817a(0x13f)],
                        'where': {
                            'tenantId': _0x2f6bec,
                            [sequelize_1['Op']['or']]: {
                                'status': { [sequelize_1['Op']['ne']]: _0x4cf910[_0x11817a(0xf7)] },
                                'isFarewellMessage': !![]
                            },
                            'channel': _0x4cf910[_0x11817a(0x139)],
                            'whatsappId': _0x28e4e3['id']
                        },
                        'include': [_0x4cf910[_0x11817a(0x10b)]]
                    },
                    {
                        'model': Message_1[_0x11817a(0xdf)],
                        'as': _0x4cf910[_0x11817a(0xcd)],
                        'include': [_0x4cf910[_0x11817a(0x10b)]]
                    }
                ],
                'order': [[
                        _0x4cf910[_0x11817a(0x14d)],
                        _0x4cf910[_0x11817a(0x11e)]
                    ]]
            });
        let _0x11bd31;
        for (const _0x58a3a8 of _0x4c1916) {
            const _0x59d77c = _0x58a3a8, {ticket: _0xb79b38} = _0x59d77c, _0x48e757 = _0xb79b38[_0x11817a(0xd8)][_0x11817a(0xce) + 'd'];
            try {
                if (![
                        _0x4cf910[_0x11817a(0xe8)],
                        _0x4cf910[_0x11817a(0x152)]
                    ][_0x11817a(0x145)](_0x59d77c[_0x11817a(0x100)]) && _0x59d77c[_0x11817a(0x114)]) {
                    const _0x648ee6 = (-0x88f * -0x2 + -0x1 * -0x756 + -0x1874, path_1[_0x11817a(0x12a)])(__dirname, '..', '..', '..', _0x4cf910[_0x11817a(0xfb)]), _0x151859 = (-0xdfd * 0x1 + 0x1d8c + -0xf8f, path_1[_0x11817a(0x12a)])(_0x648ee6, _0x59d77c[_0x11817a(0x114)]), _0x595edb = yield (-0x199 * 0x13 + -0x97b + 0x27d6, promises_1[_0x11817a(0xd2)])(_0x151859);
                    if (_0x4cf910[_0x11817a(0x13b)](_0x59d77c[_0x11817a(0x100)], _0x4cf910[_0x11817a(0x103)]) || _0x4cf910[_0x11817a(0x127)](_0x59d77c[_0x11817a(0x100)], _0x4cf910[_0x11817a(0x144)])) {
                        const _0xe5ceec = _0x59d77c[_0x11817a(0x114)][_0x11817a(0xcb)]('.'), _0x266f8b = (-0x52 * 0xd + -0x112c + 0x1556, path_1[_0x11817a(0x12a)])(_0x648ee6, _0xe5ceec[-0xc2 * 0x11 + -0x2 * 0x10bb + 0x2e58] + _0x11817a(0x113));
                        yield new Promise((_0x589379, _0xd436b5) => {
                            const _0xe78c20 = _0x11817a;
                            (-0xab3 * -0x1 + -0x1 * 0x445 + -0x66e, fluent_ffmpeg_1[_0xe78c20(0xdf)])(_0x151859)[_0xe78c20(0x117)](_0x4cf910[_0xe78c20(0x141)])['on'](_0x4cf910[_0xe78c20(0x150)], _0x5029ec => _0xd436b5(_0x5029ec))['on'](_0x4cf910[_0xe78c20(0x14e)], () => _0x589379(!![]))[_0xe78c20(0x122)](_0x266f8b);
                        });
                        const _0x3ab25d = yield (0x8ef * 0x2 + -0x24c3 + -0x2b3 * -0x7, promises_1[_0x11817a(0xd2)])(_0x266f8b);
                        _0x11bd31 = yield _0x28e4e3[_0x11817a(0xe2)](_0x48e757, _0x3ab25d);
                    }
                    if (_0x4cf910[_0x11817a(0x127)](_0x59d77c[_0x11817a(0x100)], _0x4cf910[_0x11817a(0x130)])) {
                        const _0x2ce84c = yield (-0x3d * 0x6 + 0x1f2c + 0x51 * -0x5e, sharp_1[_0x11817a(0xdf)])(_0x595edb)[_0x11817a(0x11c)]()[_0x11817a(0x123)](), _0x2455ef = {};
                        _0x2455ef[_0x11817a(0x105)] = _0x59d77c[_0x11817a(0x114)], _0x11bd31 = yield _0x28e4e3[_0x11817a(0x134)](_0x48e757, _0x2ce84c, _0x2455ef);
                    }
                    if (_0x4cf910[_0x11817a(0x127)](_0x59d77c[_0x11817a(0x100)], _0x4cf910[_0x11817a(0x11b)])) {
                        const _0x255f80 = {};
                        _0x255f80[_0x11817a(0x105)] = _0x59d77c[_0x11817a(0x114)], _0x11bd31 = yield _0x28e4e3[_0x11817a(0xca)](_0x48e757, _0x595edb, _0x255f80);
                    }
                    if ([
                            _0x4cf910[_0x11817a(0x108)],
                            _0x4cf910[_0x11817a(0xd6)],
                            _0x4cf910[_0x11817a(0xe7)]
                        ][_0x11817a(0x145)](_0x59d77c[_0x11817a(0x100)])) {
                        const _0x252423 = {};
                        _0x252423[_0x11817a(0x105)] = _0x59d77c[_0x11817a(0x114)], _0x11bd31 = yield _0x28e4e3[_0x11817a(0x133)](_0x48e757, _0x595edb, _0x252423);
                    }
                }
                [
                    _0x4cf910[_0x11817a(0xe8)],
                    _0x4cf910[_0x11817a(0x152)]
                ][_0x11817a(0x145)](_0x59d77c[_0x11817a(0x100)]) && !_0x59d77c[_0x11817a(0x114)] && (_0x11bd31 = yield _0x28e4e3[_0x11817a(0xed)](_0x48e757, _0x59d77c[_0x11817a(0x11a)]));
                const _0x4bef16 = Object[_0x11817a(0x12d)](Object[_0x11817a(0x12d)](Object[_0x11817a(0x12d)]({}, _0x59d77c), _0x11bd31), {
                        'id': _0x59d77c['id'],
                        'timestamp': _0x59d77c[_0x11817a(0xfc)],
                        'messageId': _0x11bd31[_0x11817a(0xf9)],
                        'status': _0x4cf910[_0x11817a(0xdc)],
                        'ack': 0x2
                    }), _0x3d774e = {};
                _0x3d774e['id'] = _0x59d77c['id'];
                const _0x4a0b2a = {};
                _0x4a0b2a[_0x11817a(0x13c)] = _0x3d774e, yield Message_1[_0x11817a(0xdf)][_0x11817a(0x107)](Object[_0x11817a(0x12d)]({}, _0x4bef16), _0x4a0b2a), (-0x1ae6 + -0x1 * -0xfe1 + 0xd * 0xd9, socketEmit_1[_0x11817a(0xdf)])({
                    'tenantId': _0xb79b38[_0x11817a(0x101)],
                    'type': _0x4cf910[_0x11817a(0xe5)],
                    'payload': Object[_0x11817a(0x12d)](Object[_0x11817a(0x12d)]({}, _0x59d77c[_0x11817a(0x121)]), {
                        'mediaUrl': _0x59d77c[_0x11817a(0x14c)],
                        'id': _0x59d77c['id'],
                        'timestamp': _0x59d77c[_0x11817a(0xfc)],
                        'messageId': _0x11bd31[_0x11817a(0xf9)],
                        'status': _0x4cf910[_0x11817a(0xdc)],
                        'ack': 0x2
                    })
                }), logger_1[_0x11817a(0x148)][_0x11817a(0x140)](_0x4cf910[_0x11817a(0x138)]), yield (-0x3da * -0x1 + 0x1ea1 * -0x1 + 0x8ed * 0x3, SetTicketMessagesAsRead_1[_0x11817a(0xdf)])(_0xb79b38), yield (0x1b * 0x112 + 0x8d7 * -0x1 + 0x1 * -0x140f, sleepRandomTime_1[_0x11817a(0x115) + _0x11817a(0xdd)])({
                    'minMilliseconds': _0x4cf910[_0x11817a(0xe0)](Number, -0x6b4 + 0x66b * 0x6 + -0x2 * 0xeed),
                    'maxMilliseconds': _0x4cf910[_0x11817a(0x12c)](Number, -0x2 * 0xc01 + 0x1f4 * 0x13 + -0x12 * 0x67)
                });
            } catch (_0x4cfb82) {
                const _0x5ca2f9 = _0x59d77c['id'], _0x45e96f = _0x59d77c[_0x11817a(0xe6)]['id'];
                logger_1[_0x11817a(0x148)][_0x11817a(0x126)](_0x11817a(0x10d) + _0x11817a(0x12f) + _0x11817a(0xcc) + _0x2f6bec + (_0x11817a(0x12e) + '\x20') + _0x45e96f + ')'), logger_1[_0x11817a(0x148)][_0x11817a(0x126)](_0x11817a(0xd3) + _0x11817a(0xe4) + _0x11817a(0xd0) + _0x5ca2f9 + _0x11817a(0xc9) + _0x4cfb82);
            }
        }
    });
exports[_0x4a536e(0xdf)] = MessengerSendMessagesSystem;