'use strict';
const _0x21ddcc = _0x4fb3;
(function (_0xab84e3, _0x5d8c1c) {
    const _0x3cae4d = _0x4fb3, _0x1d9e6e = _0xab84e3();
    while (!![]) {
        try {
            const _0x2a79e8 = parseInt(_0x3cae4d(0x20b)) / (-0x225e + 0x1fef + 0x1 * 0x270) + -parseInt(_0x3cae4d(0x204)) / (-0x1 * 0x1582 + -0x3d * 0x48 + 0x26ac) * (parseInt(_0x3cae4d(0x219)) / (0xc * -0x52 + 0x5 * -0x1d + -0x236 * -0x2)) + parseInt(_0x3cae4d(0x227)) / (0x1 * 0x22f3 + -0x25a1 + -0x3 * -0xe6) + -parseInt(_0x3cae4d(0x236)) / (-0x1c2 + -0x27b * 0x5 + 0xe2e) + parseInt(_0x3cae4d(0x23a)) / (-0x1e1b + 0x1 * 0xf35 + 0xeec) + -parseInt(_0x3cae4d(0x1fb)) / (0x1273 * -0x2 + -0x1 * 0x1c42 + 0x412f) + -parseInt(_0x3cae4d(0x23b)) / (0xaa9 + 0x1df9 + -0x2 * 0x144d);
            if (_0x2a79e8 === _0x5d8c1c)
                break;
            else
                _0x1d9e6e['push'](_0x1d9e6e['shift']());
        } catch (_0x353f5c) {
            _0x1d9e6e['push'](_0x1d9e6e['shift']());
        }
    }
}(_0x5510, -0x3b8d7 + -0x1 * -0x3d52f + 0x2b16e));
function _0x5510() {
    const _0x2e2c7b = [
        'ervices/Sh',
        'AKaXe',
        'payload',
        '1326927fpIqxo',
        'ticket',
        'status',
        'contactId',
        '../../help',
        'erty',
        'throw',
        'qLMNE',
        'contact',
        '465670MpdbhF',
        'open',
        '../TicketS',
        'sequelize',
        'defineProp',
        'findOne',
        'body',
        '253522ldbAkQ',
        'quotedMsg',
        '__awaiter',
        'where',
        'KxHGC',
        'getTime',
        'update',
        'rvice',
        'TbgFc',
        'tenantId',
        'yhLCv',
        'fault',
        'ls/Message',
        'apply',
        '3anZzzl',
        'aiRLr',
        '../../mode',
        'type',
        'then',
        'xNoAg',
        'ers/socket',
        'next',
        'ERR_CREATI',
        'DwDwm',
        'RybvM',
        '_SYSTEM',
        'value',
        'AUAde',
        '1386940CiCWfc',
        'isGroup',
        'KEUAZ',
        'TMkEi',
        'yZVmD',
        'chat',
        'jYpIt',
        'done',
        '__esModule',
        'SZrRm',
        'mediaType',
        'qZHUz',
        'whatsappId',
        '__importDe',
        'kbOPa',
        '517720KOsBfU',
        'ls/Ticket',
        'create',
        'owTicketSe',
        '1136652QeYbtX',
        '640072fLAdiZ',
        'pending',
        'model',
        'VDYIe',
        'JaDsp',
        'include',
        'default',
        'mediaName',
        'mZXPL',
        'chat:creat',
        'Emit',
        'NG_MESSAGE',
        'findByPk'
    ];
    _0x5510 = function () {
        return _0x2e2c7b;
    };
    return _0x5510();
}
var __awaiter = this && this[_0x21ddcc(0x20d)] || function (_0x56fddb, _0x3166f0, _0x22aa19, _0x19b3a8) {
        const _0x57fc28 = _0x21ddcc, _0x1fa3d5 = {
                'qZHUz': function (_0x2dcc39, _0xd8405c) {
                    return _0x2dcc39(_0xd8405c);
                },
                'AUAde': function (_0x146c13, _0x4bf7bc) {
                    return _0x146c13 instanceof _0x4bf7bc;
                },
                'xNoAg': function (_0x1d68ba, _0x4fa8af) {
                    return _0x1d68ba(_0x4fa8af);
                },
                'qLMNE': function (_0x3b67c8, _0x309480) {
                    return _0x3b67c8(_0x309480);
                },
                'aiRLr': _0x57fc28(0x201),
                'yhLCv': function (_0x7e8cfd, _0x1cf6f6) {
                    return _0x7e8cfd(_0x1cf6f6);
                },
                'TMkEi': function (_0x5ecf9d, _0x19834c) {
                    return _0x5ecf9d(_0x19834c);
                }
            };
        function _0x26a0c4(_0x3b9a28) {
            const _0xcda68 = _0x57fc28;
            return _0x1fa3d5[_0xcda68(0x226)](_0x3b9a28, _0x22aa19) ? _0x3b9a28 : new _0x22aa19(function (_0x1c0cff) {
                const _0x3d30c3 = _0xcda68;
                _0x1fa3d5[_0x3d30c3(0x232)](_0x1c0cff, _0x3b9a28);
            });
        }
        return new (_0x22aa19 || (_0x22aa19 = Promise))(function (_0x23f511, _0x4e219e) {
            const _0x4fd554 = _0x57fc28, _0x29140b = {
                    'AKaXe': function (_0x423db1, _0x80df34) {
                        const _0x2c5b19 = _0x4fb3;
                        return _0x1fa3d5[_0x2c5b19(0x232)](_0x423db1, _0x80df34);
                    },
                    'yZVmD': _0x1fa3d5[_0x4fd554(0x21a)],
                    'KEUAZ': function (_0x4c10a1, _0x1f9991) {
                        const _0x36aee1 = _0x4fd554;
                        return _0x1fa3d5[_0x36aee1(0x215)](_0x4c10a1, _0x1f9991);
                    }
                };
            function _0x200537(_0x4fd577) {
                const _0x224474 = _0x4fd554;
                try {
                    _0x29140b[_0x224474(0x1f9)](_0x4472fd, _0x19b3a8[_0x224474(0x220)](_0x4fd577));
                } catch (_0x24a945) {
                    _0x29140b[_0x224474(0x1f9)](_0x4e219e, _0x24a945);
                }
            }
            function _0x4d984f(_0x3c3a69) {
                const _0x4ca3bd = _0x4fd554;
                try {
                    _0x29140b[_0x4ca3bd(0x1f9)](_0x4472fd, _0x19b3a8[_0x29140b[_0x4ca3bd(0x22b)]](_0x3c3a69));
                } catch (_0x2fb7e9) {
                    _0x29140b[_0x4ca3bd(0x229)](_0x4e219e, _0x2fb7e9);
                }
            }
            function _0x4472fd(_0x368bde) {
                const _0x102908 = _0x4fd554;
                _0x368bde[_0x102908(0x22e)] ? _0x1fa3d5[_0x102908(0x21e)](_0x23f511, _0x368bde[_0x102908(0x225)]) : _0x1fa3d5[_0x102908(0x202)](_0x26a0c4, _0x368bde[_0x102908(0x225)])[_0x102908(0x21d)](_0x200537, _0x4d984f);
            }
            _0x1fa3d5[_0x4fd554(0x22a)](_0x4472fd, (_0x19b3a8 = _0x19b3a8[_0x4fd554(0x218)](_0x56fddb, _0x3166f0 || []))[_0x4fd554(0x220)]());
        });
    }, __importDefault = this && this[_0x21ddcc(0x234) + _0x21ddcc(0x216)] || function (_0x1a1c05) {
        const _0x1632ce = _0x21ddcc;
        return _0x1a1c05 && _0x1a1c05[_0x1632ce(0x22f)] ? _0x1a1c05 : { 'default': _0x1a1c05 };
    };
const _0x4973de = {};
function _0x4fb3(_0x201483, _0x3753a9) {
    const _0x10254a = _0x5510();
    return _0x4fb3 = function (_0x356375, _0x36d933) {
        _0x356375 = _0x356375 - (0x1237 * -0x2 + 0x3 * -0x91f + -0x9 * -0x74e);
        let _0xdccd7f = _0x10254a[_0x356375];
        return _0xdccd7f;
    }, _0x4fb3(_0x201483, _0x3753a9);
}
_0x4973de[_0x21ddcc(0x225)] = !![], Object[_0x21ddcc(0x208) + _0x21ddcc(0x200)](exports, _0x21ddcc(0x22f), _0x4973de);
const sequelize_1 = require(_0x21ddcc(0x207)), socketEmit_1 = __importDefault(require(_0x21ddcc(0x1ff) + _0x21ddcc(0x21f) + _0x21ddcc(0x1f5))), Message_1 = __importDefault(require(_0x21ddcc(0x21b) + _0x21ddcc(0x217))), Ticket_1 = __importDefault(require(_0x21ddcc(0x21b) + _0x21ddcc(0x237))), ShowTicketService_1 = __importDefault(require(_0x21ddcc(0x206) + _0x21ddcc(0x1f8) + _0x21ddcc(0x239) + _0x21ddcc(0x212))), CreateForwardMessageService = ({
        userId: _0xb95982,
        tenantId: _0x261593,
        message: _0x4977a2,
        contact: _0x3c65d8,
        ticketIdOrigin: _0x17d920
    }) => __awaiter(void (0xa * -0x295 + -0x1b10 + 0x7 * 0x78e), void (0x1d * 0x7b + -0x1eab + -0x12 * -0xee), void (0x1687 + -0x1d05 + -0x3 * -0x22a), function* () {
        const _0x1dc413 = _0x21ddcc, _0x206ee4 = {};
        _0x206ee4[_0x1dc413(0x223)] = _0x1dc413(0x205), _0x206ee4[_0x1dc413(0x22d)] = _0x1dc413(0x23c), _0x206ee4[_0x1dc413(0x222)] = function (_0x419715, _0x2af6d5) {
            return _0x419715 === _0x2af6d5;
        }, _0x206ee4[_0x1dc413(0x1f3)] = function (_0x3bf262, _0x3e5520) {
            return _0x3bf262 === _0x3e5520;
        }, _0x206ee4[_0x1dc413(0x23e)] = _0x1dc413(0x22c), _0x206ee4[_0x1dc413(0x23f)] = _0x1dc413(0x1fc), _0x206ee4[_0x1dc413(0x230)] = _0x1dc413(0x203), _0x206ee4[_0x1dc413(0x235)] = _0x1dc413(0x20c), _0x206ee4[_0x1dc413(0x213)] = _0x1dc413(0x221) + _0x1dc413(0x1f6) + _0x1dc413(0x224), _0x206ee4[_0x1dc413(0x20f)] = _0x1dc413(0x1f4) + 'e';
        const _0x4dd747 = _0x206ee4, _0x4ab153 = {};
        _0x4ab153['id'] = _0x17d920, _0x4ab153[_0x1dc413(0x214)] = _0x261593;
        const _0x3ff53d = yield (0x1 * 0x14ae + 0x37 * -0x9 + -0x1 * 0x12bf, ShowTicketService_1[_0x1dc413(0x241)])(_0x4ab153);
        let _0x28567d;
        const _0x24ce36 = {
                [sequelize_1['Op']['or']]: [
                    _0x4dd747[_0x1dc413(0x223)],
                    _0x4dd747[_0x1dc413(0x22d)]
                ]
            }, _0x1e2e43 = {};
        _0x1e2e43[_0x1dc413(0x1fd)] = _0x24ce36, _0x1e2e43[_0x1dc413(0x214)] = _0x261593, _0x1e2e43[_0x1dc413(0x1fe)] = _0x3c65d8['id'];
        const _0x50bf5a = {};
        _0x50bf5a[_0x1dc413(0x20e)] = _0x1e2e43, _0x28567d = yield Ticket_1[_0x1dc413(0x241)][_0x1dc413(0x209)](_0x50bf5a);
        !_0x28567d && (_0x28567d = yield Ticket_1[_0x1dc413(0x241)][_0x1dc413(0x238)]({
            'contactId': _0x3c65d8['id'],
            'status': _0x4dd747[_0x1dc413(0x223)],
            'isGroup': _0x3c65d8[_0x1dc413(0x228)],
            'userId': _0xb95982,
            'tenantId': _0x261593,
            'unreadMessages': 0x0,
            'whatsappId': _0x3ff53d[_0x1dc413(0x233)],
            'lastMessage': _0x4977a2[_0x1dc413(0x20a)],
            'lastMessageAt': new Date()[_0x1dc413(0x210)](),
            'answered': !![]
        }));
        const _0x6a80ce = {
                'body': _0x4977a2[_0x1dc413(0x20a)],
                'contactId': _0x3c65d8['id'],
                'fromMe': !![],
                'read': !![],
                'mediaType': _0x4dd747[_0x1dc413(0x222)](_0x4977a2, null) || _0x4dd747[_0x1dc413(0x222)](_0x4977a2, void (0xc2 * 0x12 + -0x245d + 0x15 * 0x115)) ? void (-0x74 * -0x2f + 0x833 * 0x1 + -0x1d7f) : _0x4977a2[_0x1dc413(0x231)],
                'mediaUrl': _0x4dd747[_0x1dc413(0x222)](_0x4977a2, null) || _0x4dd747[_0x1dc413(0x222)](_0x4977a2, void (0x2543 + -0x1 * 0x238a + 0x7 * -0x3f)) ? void (-0x22 * -0xca + 0x13d * -0x1d + 0x915) : _0x4977a2[_0x1dc413(0x242)],
                'mediaName': _0x4dd747[_0x1dc413(0x1f3)](_0x4977a2, null) || _0x4dd747[_0x1dc413(0x1f3)](_0x4977a2, void (-0x9b8 + -0x987 * 0x3 + 0x7a9 * 0x5)) ? void (0x5bb + 0xfd1 + -0x158c) : _0x4977a2[_0x1dc413(0x242)],
                'timestamp': new Date()[_0x1dc413(0x210)](),
                'userId': _0xb95982,
                'scheduleDate': null,
                'sendType': _0x4dd747[_0x1dc413(0x23e)],
                'status': _0x4dd747[_0x1dc413(0x22d)],
                'ticketId': _0x28567d['id'],
                'tenantId': _0x261593
            }, _0x1810f3 = yield Message_1[_0x1dc413(0x241)][_0x1dc413(0x238)](_0x6a80ce), _0xbf09a6 = {};
        _0xbf09a6[_0x1dc413(0x214)] = _0x261593;
        const _0x57a7ed = {};
        _0x57a7ed[_0x1dc413(0x23d)] = Ticket_1[_0x1dc413(0x241)], _0x57a7ed['as'] = _0x4dd747[_0x1dc413(0x23f)], _0x57a7ed[_0x1dc413(0x20e)] = _0xbf09a6, _0x57a7ed[_0x1dc413(0x240)] = [_0x4dd747[_0x1dc413(0x230)]];
        const _0x414183 = yield Message_1[_0x1dc413(0x241)][_0x1dc413(0x1f7)](_0x1810f3['id'], {
            'include': [
                _0x57a7ed,
                {
                    'model': Message_1[_0x1dc413(0x241)],
                    'as': _0x4dd747[_0x1dc413(0x235)],
                    'include': [_0x4dd747[_0x1dc413(0x230)]]
                }
            ]
        });
        if (!_0x414183)
            throw new Error(_0x4dd747[_0x1dc413(0x213)]);
        yield _0x28567d[_0x1dc413(0x211)]({
            'lastMessage': _0x414183[_0x1dc413(0x20a)],
            'lastMessageAt': new Date()[_0x1dc413(0x210)](),
            'answered': !![]
        });
        const _0x5d6fda = {};
        _0x5d6fda[_0x1dc413(0x214)] = _0x261593, _0x5d6fda[_0x1dc413(0x21c)] = _0x4dd747[_0x1dc413(0x20f)], _0x5d6fda[_0x1dc413(0x1fa)] = _0x414183, (0x2f9 + 0x6ff + -0x8 * 0x13f, socketEmit_1[_0x1dc413(0x241)])(_0x5d6fda);
    });
exports[_0x21ddcc(0x241)] = CreateForwardMessageService;